import pygame
import serial
import time

# Replace 'COM4' with your MegaPi COM port
arduino = serial.Serial('COM4', 9600)
time.sleep(2)  # Give Arduino a moment to start

def send_command(cmd):
    arduino.write(cmd.encode())

# Initialize pygame joystick
pygame.init()
pygame.joystick.init()

if pygame.joystick.get_count() == 0:
    print("No joystick found!")
    exit()

joystick = pygame.joystick.Joystick(0)
joystick.init()
print(f"Joystick detected: {joystick.get_name()}")

while True:
    pygame.event.pump()  # Process events

    # Left stick axes
    axis_x = joystick.get_axis(0)  # Left stick horizontal (-1 left, 1 right)
    axis_y = joystick.get_axis(1)  # Left stick vertical (-1 up, 1 down)

    # Forward/backward
    if axis_y < -0.3:
        send_command('F')
    elif axis_y > 0.3:
        send_command('B')
    else:
        send_command('S')

    # Left/right
    if axis_x < -0.3:
        send_command('L')
    elif axis_x > 0.3:
        send_command('R')

    time.sleep(0.05)  # Small delay to avoid flooding the serial
